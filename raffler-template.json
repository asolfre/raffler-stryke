{"appInstanceDefinition":{"name":"raffler-1580157787189","title":"Raffler","description":"Raffles made easy!"},"entityMetadataDefinition":{"winner":{"entityName":"winner","entityIcon":"trophy","entityColor":"#d4af37","description":"The winner of a raffle","title":"Winners","alias":{"pattern":"[$]-{00000}"},"fields":[{"name":"raffle","type":"lookup","relatedTo":"raffle","label":"Raffle","required":true},{"name":"participant","type":"lookup","relatedTo":"participant","label":"Participant","required":true}],"public":true},"credentials":{"entityName":"credentials","entityIcon":"key","entityColor":"#ff8000","description":"Credentials used to connect to different services: Slack, email, etc.","title":"Credentials","alias":{"pattern":"[$]-{00000}"},"fields":[{"name":"name","description":"","type":"string","label":"Name","required":true},{"name":"service","description":"","type":"string","label":"Service","required":true},{"name":"apiKey","description":"","type":"string","label":"API Key","required":false},{"name":"accessToken","description":"","type":"string","label":"Access Token","required":false},{"name":"secretKey","description":"","type":"string","label":"Secret Key","required":false}],"public":false},"raffle":{"entityName":"raffle","entityIcon":"random","entityColor":"#82bfb0","description":"The raffle of an object/prize","title":"Raffles","alias":{"pattern":"[$]-{00000}"},"fields":[{"name":"name","type":"string","label":"Name","required":true}],"public":true},"prize":{"entityName":"prize","entityIcon":"gift","entityColor":"#50c878","description":"","title":"Prizes","alias":{"pattern":"[$]-{00000}"},"fields":[{"name":"name","type":"string","label":"Name","required":true},{"name":"raffle","type":"lookup","relatedTo":"raffle","label":"Raffle","required":true}],"public":true},"participant":{"entityName":"participant","entityIcon":"user-check","entityColor":"#966fd6","description":"","title":"Participants","alias":{"pattern":"[$]-{00000}"},"fields":[{"name":"name","type":"string","label":"Name","required":true},{"name":"user","type":"lookup","relatedTo":"user","label":"User","required":false},{"name":"raffle","type":"lookup","relatedTo":"raffle","label":"Raffle","required":true}],"public":true}},"actions":{"performRaffle":{"actionName":"performRaffle","actionLabel":"Raffle!","actionDescription":"Find a winner for this raffle","scriptDefinitionName":"raffle","entityMetadataDefinitionName":"raffle","type":"buttonAction","returnType":"string"},"notifyWinner":{"actionName":"notifyWinner","actionLabel":"Notify winner","actionDescription":"","scriptDefinitionName":"notifyWinner","entityMetadataDefinitionName":"raffle","type":"buttonAction","returnType":"string"},"enterRaffle":{"actionName":"enterRaffle","actionLabel":"Enter raffle","actionDescription":"Join this raffle","scriptDefinitionName":"enterRaffle","entityMetadataDefinitionName":"raffle","type":"buttonAction","returnType":"string"}},"scripts":{"raffle":{"scriptName":"raffle","scriptLanguage":"js","scriptSource":"Ci8qKgogKiBIZXJlIGlzIHlvdXIgbmV3IFN0cnlrZSBzY3JpcHQhCiAqCiAqIERvbid0IGZvcmdldCB0byBjaGVjayBvdXQgb3VyIGRvY3MgZm9yIGRldGFpbHMgYW5kIGFsd2F5cyBlbmQgeW91ciBzY3JpcHQgd2l0aCBzdHJ5a2UucmVzb2x2ZSgpCiAqLwpjb25zdCB1dGlsID0gcmVxdWlyZSgndXRpbCcpOwpjb25zdCByYWZmbGUgPSBzdHJ5a2UuZGF0YS5yZWNvcmQ7CgpnZXRQYXJ0aWNpcGFudHNGb3JDdXJyZW50UmFmZmxlKCkudGhlbigocGFydGljaXBhbnRzKSA9PiB7CiAgICBpZiAocGFydGljaXBhbnRzLlBhcnRpY2lwYW50ID09PSB1bmRlZmluZWQgfHwgcGFydGljaXBhbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHN0cnlrZS5lcnJvcignVGhlcmUgYXJlIG5vIHBhcnRpY2lwYW50cyBvbiB0aGlzIHJhZmZsZSEnKTsKICAgIH0KICAgIGNvbnNvbGUubG9nKGBwYXJ0aWNpcGFudHMgY291bnQ6ICR7cGFydGljaXBhbnRzLlBhcnRpY2lwYW50Lmxlbmd0aH1gKTsKCiAgICAvLyBDaGVjayBpZiBhIHdpbm5lciBhbHJlYWR5IGV4aXN0cwogICAgZ2V0RXhpc3RpbmdXaW5uZXIoKS50aGVuKChleGlzdGluZ1dpbm5lcikgPT4gewogICAgICAgIGlmIChleGlzdGluZ1dpbm5lci5XaW5uZXIgIT09IHVuZGVmaW5lZCAmJiBleGlzdGluZ1dpbm5lci5XaW5uZXIubGVuZ3RoID4gMCkgewoKICAgICAgICAgICAgc3RyeWtlLmVycm9yKCdUaGVyZSBpcyBhIHdpbm5lciBhbHJlYWR5IScpOwogICAgICAgIH0KICAgIAogICAgICAgIC8vIEZpbmQgYSB3aW5uZXIKICAgICAgICBjb25zdCBuZXdXaW5uZXIgPSBwYXJ0aWNpcGFudHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcGFydGljaXBhbnRzLmxlbmd0aCldOwogICAgCiAgICAgICAgY29uc3QgcmFmZmxlV2lubmVyID0ge307CiAgICAgICAgcmFmZmxlV2lubmVyLm5hbWUgPSBuZXdXaW5uZXIubmFtZTsKICAgICAgICByYWZmbGVXaW5uZXIucGFydGljaXBhbnQgPSBuZXdXaW5uZXIuaWQ7CiAgICAKICAgICAgICAvLyBzYXZlIHRoZSBuZXcgd2lubmVyCiAgICAgICAgc3RyeWtlLmNyZWF0ZSgnd2lubmVyJywgcmFmZmxlV2lubmVyLCAoZXJyLCByZWNvcmRzU2F2ZWQpID0+IHsKICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgc3RyeWtlLmVycm9yKGVyci5tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zb2xlLmxvZygnc2F2ZWQ6ICcgKyByZWNvcmRzU2F2ZWQpOwogICAgICAgICAgICBzdHJ5a2UucmVzb2x2ZShgVGhlIHdpbm5lciBpczogJHtyYWZmbGVXaW5uZXIubmFtZX1gKTsKICAgICAgICB9KSAgCiAgICB9KTsKCn0pLmNhdGNoKChlcnIpID0+IHsKICAgIHN0cnlrZS5lcnJvcignQWN0aW9uIGZhaWxlZCB3aGlsZSByZXRyaWV2aW5nIHRoZSBwYXJ0aWNpcGFudHM6ICcgKyBlcnIpOwp9KTsKCi8qKgogKiBDaGVjayBpZiBhIHdpbm5lciBhbHJlYWR5IGV4aXN0cwogKi8KYXN5bmMgZnVuY3Rpb24gZ2V0RXhpc3RpbmdXaW5uZXIoKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBjb25zdCB3aW5uZXJzUXVlcnkgPSBgewogICAgICAgICAgICBXaW5uZXIoZmlsdGVyOiB7cmFmZmxlOiB7ZXE6ICIke3JhZmZsZS5pZH0ifX0pIHsKICAgICAgICAgICAgICAgIHBhcnRpY2lwYW50IHsKICAgICAgICAgICAgICAgICAgICBpZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgfQogICAgICAgIH1gOwogICAgICAgICAgICAgICAgCiAgICAgICAgc3RyeWtlLnF1ZXJ5KHdpbm5lcnNRdWVyeSwgdHJ1ZSwgKGVyciwgcmVzdWx0KSA9PiB7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBxdWVyeVJlc3VsdCA9IHByb2Nlc3NRdWVyeVJlc3VsdChlcnIsIHJlc3VsdCwgJ3dpbm5lcnNRdWVyeScpOyAgICAgICAgICAgIAogICAgICAgICAgICByZXNvbHZlKHF1ZXJ5UmVzdWx0KTsKICAgICAgICB9KTsKICAgIH0pOwp9CgovKioKICogR2V0IHBhcnRpY2lwYW50cwogKi8KYXN5bmMgZnVuY3Rpb24gZ2V0UGFydGljaXBhbnRzRm9yQ3VycmVudFJhZmZsZSgpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIGNvbnN0IHBhcnRpY2lwYW50c1F1ZXJ5ID0gYHsKICAgICAgICAgICAgUGFydGljaXBhbnQoZmlsdGVyOiB7cmFmZmxlOiB7ZXE6ICIke3JhZmZsZS5pZH0ifX0pIHsKICAgICAgICAgICAgICAgIG5hbWUKICAgICAgICAgICAgICAgIHVzZXIgewogICAgICAgICAgICAgICAgICAgIGlkCiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlkCiAgICAgICAgICAgIH0KICAgICAgICB9YDsKICAgICAgICAgICAgICAgIAogICAgICAgIHN0cnlrZS5xdWVyeShwYXJ0aWNpcGFudHNRdWVyeSwgdHJ1ZSwgKGVyciwgcmVzdWx0KSA9PiB7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBxdWVyeVJlc3VsdCA9IHByb2Nlc3NRdWVyeVJlc3VsdChlcnIsIHJlc3VsdCwgJ3BhcnRpY2lwYW50cycpOyAgICAgICAgICAgIAogICAgICAgICAgICByZXNvbHZlKHF1ZXJ5UmVzdWx0KTsKICAgICAgICB9KTsKICAgIH0pOwp9CgpmdW5jdGlvbiBwcm9jZXNzUXVlcnlSZXN1bHQoZXJyLCByZXN1bHQsIHF1ZXJ5TmFtZSkgewogICAgaWYgKGVycikgewogICAgICAgIHN0cnlrZS5lcnJvcihgcXVlcnkgcmVxdWVzdCAoJHtxdWVyeU5hbWV9KSBmYWlsZWQ6ICR7dXRpbC5pbnNwZWN0KGVycil9YCk7IAogICAgfQoKICAgIGlmIChyZXN1bHQuZXJyb3JzKSB7CiAgICAgICAgc3RyeWtlLmVycm9yKGBxdWVyeSAoJHtxdWVyeU5hbWV9KSBmYWlsZWQ6ICR7dXRpbC5pbnNwZWN0KHJlc3VsdC5lcnJvcnMpfWApOyAgICAgICAgIAogICAgfQoKICAgIGlmICghcmVzdWx0LmRhdGEpIHsKICAgICAgICBzdHJ5a2UuZXJyb3IoYHF1ZXJ5IHJlc3VsdCBtaXNzaW5nIGZvciAke3F1ZXJ5TmFtZX1gKTsgICAgICAgICAKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0LmRhdGE7Cn0=","scriptArguments":[{"argumentName":"user","argumentType":"object","argumentSourceType":"userInfo","argumentSourceDefinition":null},{"argumentName":"recordInContext","argumentType":"object","argumentSourceType":"recordInContext","argumentSourceDefinition":null}],"scriptResultDefinition":{"returnValueName":null,"returnType":"string"}},"notifyWinner":{"scriptName":"notifyWinner","scriptLanguage":"js","scriptSource":"Ci8qKgogKiBIZXJlIGlzIHlvdXIgbmV3IFN0cnlrZSBzY3JpcHQhCiAqCiAqIERvbid0IGZvcmdldCB0byBjaGVjayBvdXQgb3VyIGRvY3MgZm9yIGRldGFpbHMgYW5kIGFsd2F5cyBlbmQgeW91ciBzY3JpcHQgd2l0aCBzdHJ5a2UucmVzb2x2ZSgpCiAqLwpjb25zb2xlLmxvZygnSGVsbG8gc3RyeWtlIScpOwoKc3RyeWtlLnJlc29sdmUoJ05vdGlmaWVkIScpOwo=","scriptArguments":[{"argumentName":"user","argumentType":"object","argumentSourceType":"userInfo","argumentSourceDefinition":null},{"argumentName":"recordInContext","argumentType":"object","argumentSourceType":"recordInContext","argumentSourceDefinition":null}],"scriptResultDefinition":{"returnValueName":null,"returnType":"string"}},"enterRaffle":{"scriptName":"enterRaffle","scriptLanguage":"js","scriptSource":"Ci8qKgogKiBIZXJlIGlzIHlvdXIgbmV3IFN0cnlrZSBzY3JpcHQhCiAqCiAqIERvbid0IGZvcmdldCB0byBjaGVjayBvdXQgb3VyIGRvY3MgZm9yIGRldGFpbHMgYW5kIGFsd2F5cyBlbmQgeW91ciBzY3JpcHQgd2l0aCBzdHJ5a2UucmVzb2x2ZSgpCiAqLwpjb25zdCB1dGlsID0gcmVxdWlyZSgndXRpbCcpOwpjb25zdCByYWZmbGUgPSBzdHJ5a2UuZGF0YS5yZWNvcmQ7CgplbnRlclJhZmZsZSgpOwoKYXN5bmMgZnVuY3Rpb24gZW50ZXJSYWZmbGUoKSB7CiAgICBjb25zdCBwYXJ0aWNpcGFudCA9IGF3YWl0IGdldFBhcnRpY2lwYW50c0ZvckN1cnJlbnRSYWZmbGVBbmRVc2VyKCk7CiAgICBpZiAocGFydGljaXBhbnQuUGFydGljaXBhbnQgIT09IHVuZGVmaW5lZCAmJiBwYXJ0aWNpcGFudC5QYXJ0aWNpcGFudC5sZW5ndGggPiAwKSB7CiAgICAgICAgc3RyeWtlLmVycm9yKCdZb3UgYXJlIGFscmVhZHkgcGFydGljaXBhdGluZyEnKTsKICAgIH0KICAgIAogICAgbGV0IG5ld1BhcnRpY2lwYW50ID0ge307CiAgICBuZXdQYXJ0aWNpcGFudC5yYWZmbGUgPSByYWZmbGUuaWQ7CiAgICBuZXdQYXJ0aWNpcGFudC51c2VyID0gc3RyeWtlLnVzZXIuaWQ7CiAgICBuZXdQYXJ0aWNpcGFudC5uYW1lID0gc3RyeWtlLnVzZXIudXNlcm5hbWU7CiAgICAKICAgIC8vIHNhdmUgdGhlIG5ldyBwYXJ0aWNpcGFudAogICAgc3RyeWtlLmNyZWF0ZSgncGFydGljaXBhbnQnLCBuZXdQYXJ0aWNpcGFudCwgKGVyciwgcmVjb3Jkc1NhdmVkKSA9PiB7CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICBzdHJ5a2UuZXJyb3IoZXJyLm1lc3NhZ2UpOwogICAgICAgIH0KICAgICAgICBjb25zb2xlLmxvZygnc2F2ZWQ6ICcgKyByZWNvcmRzU2F2ZWQpOwogICAgICAgIHN0cnlrZS5yZXNvbHZlKCdZb3VyIGFyZSBub3cgcGFydGljaXBhdGluZyBvbiB0aGlzIHJhZmZsZS4gR29vZCBsdWNrIScpOwogICAgfSk7Cn0KCi8qKgogKiBHZXQgcGFydGljaXBhbnRzCiAqLwphc3luYyBmdW5jdGlvbiBnZXRQYXJ0aWNpcGFudHNGb3JDdXJyZW50UmFmZmxlQW5kVXNlcigpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIGNvbnN0IHBhcnRpY2lwYW50c1F1ZXJ5ID0gYHsKICAgICAgICAgICAgUGFydGljaXBhbnQoZmlsdGVyOiB7IHJhZmZsZToge2VxOiAiJHtyYWZmbGUuaWR9In0sIHVzZXI6IHtlcTogIiR7c3RyeWtlLnVzZXIuaWR9In19KSB7CiAgICAgICAgICAgICAgICBuYW1lCiAgICAgICAgICAgICAgICB1c2VyIHsKICAgICAgICAgICAgICAgICAgICBpZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgfQogICAgICAgIH1gOwogICAgICAgICAgICAgICAgCiAgICAgICAgc3RyeWtlLnF1ZXJ5KHBhcnRpY2lwYW50c1F1ZXJ5LCB0cnVlLCAoZXJyLCByZXN1bHQpID0+IHsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5UmVzdWx0ID0gcHJvY2Vzc1F1ZXJ5UmVzdWx0KGVyciwgcmVzdWx0LCAncGFydGljaXBhbnRzJyk7ICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc29sdmUocXVlcnlSZXN1bHQpOwogICAgICAgIH0pOwogICAgfSk7Cn0KCmZ1bmN0aW9uIHByb2Nlc3NRdWVyeVJlc3VsdChlcnIsIHJlc3VsdCwgcXVlcnlOYW1lKSB7CiAgICBpZiAoZXJyKSB7CiAgICAgICAgc3RyeWtlLmVycm9yKGBxdWVyeSByZXF1ZXN0ICgke3F1ZXJ5TmFtZX0pIGZhaWxlZDogJHt1dGlsLmluc3BlY3QoZXJyKX1gKTsgCiAgICB9CgogICAgaWYgKHJlc3VsdC5lcnJvcnMpIHsKICAgICAgICBzdHJ5a2UuZXJyb3IoYHF1ZXJ5ICgke3F1ZXJ5TmFtZX0pIGZhaWxlZDogJHt1dGlsLmluc3BlY3QocmVzdWx0LmVycm9ycyl9YCk7ICAgICAgICAgCiAgICB9CgogICAgaWYgKCFyZXN1bHQuZGF0YSkgewogICAgICAgIHN0cnlrZS5lcnJvcihgcXVlcnkgcmVzdWx0IG1pc3NpbmcgZm9yICR7cXVlcnlOYW1lfWApOyAgICAgICAgIAogICAgfQoKICAgIHJldHVybiByZXN1bHQuZGF0YTsKfQo=","scriptArguments":[{"argumentName":"user","argumentType":"object","argumentSourceType":"userInfo","argumentSourceDefinition":null},{"argumentName":"recordInContext","argumentType":"object","argumentSourceType":"recordInContext","argumentSourceDefinition":null}],"scriptResultDefinition":{"returnValueName":null,"returnType":"string"}}},"userRoles":{"admin":{"name":"admin"},"user":{"name":"user"}},"resourcesAccess":[{"whoType":null,"whoName":"user","whatType":null,"whatName":"credentials","how":"none","type":"roleMetadata"},{"whoType":null,"whoName":"admin","whatType":null,"whatName":"credentials","how":"viewMineEditMine","type":"roleMetadata"}]}