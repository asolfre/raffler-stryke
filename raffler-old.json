{"appInstanceDefinition":{"name":"raffler-1579466489404","title":"Raffler","description":"Raffles made easy!"},"entityMetadataDefinition":{"winner":{"entityName":"winner","entityIcon":"trophy","entityColor":"#f4eeb1","description":"The winner of a raffle","title":"Winners","alias":{"pattern":"[$]-{00000}"},"fields":[{"name":"raffle","type":"lookup","relatedTo":"raffle","label":"Raffle","required":true},{"name":"participant","type":"lookup","relatedTo":"participant","label":"Participant","required":true}],"public":true},"raffle":{"entityName":"raffle","entityIcon":"random","entityColor":"#a3e7d6","description":"The raffle of an object/prize","title":"Raffles","alias":{"pattern":"[$]-{00000}"},"fields":[{"name":"name","type":"string","label":"Name","required":true}],"public":true},"participant":{"entityName":"participant","entityIcon":"user-check","entityColor":"#966fd6","description":"","title":"Participants","alias":{"pattern":"[$]-{00000}"},"fields":[{"name":"name","type":"string","label":"Name","required":true},{"name":"user","type":"lookup","relatedTo":"user","label":"User","required":false},{"name":"raffle","type":"lookup","relatedTo":"raffle","label":"Raffle","required":true}],"public":true}},"actions":{"raffle":{"actionName":"raffle","actionLabel":"Raffle!","actionDescription":"Find a winner for this raffle","scriptDefinitionName":"raffle","entityMetadataDefinitionName":"raffle","type":"buttonAction","returnType":"string"},"notifyWinner":{"actionName":"notifyWinner","actionLabel":"Notify winner","actionDescription":"","scriptDefinitionName":"notifyWinner","entityMetadataDefinitionName":"raffle","type":"buttonAction","returnType":"string"},"enterRaffle":{"actionName":"enterRaffle","actionLabel":"Enter raffle","actionDescription":"Join this raffle","scriptDefinitionName":"enterRaffle","entityMetadataDefinitionName":"raffle","type":"buttonAction","returnType":"string"}},"scripts":{"raffle":{"scriptName":"raffle","scriptLanguage":"js","scriptSource":"Ci8qKgogKiBIZXJlIGlzIHlvdXIgbmV3IFN0cnlrZSBzY3JpcHQhCiAqCiAqIERvbid0IGZvcmdldCB0byBjaGVjayBvdXQgb3VyIGRvY3MgZm9yIGRldGFpbHMgYW5kIGFsd2F5cyBlbmQgeW91ciBzY3JpcHQgd2l0aCBzdHJ5a2UucmVzb2x2ZSgpCiAqLwpjb25zdCB1dGlsID0gcmVxdWlyZSgndXRpbCcpOwpjb25zdCByYWZmbGUgPSBzdHJ5a2UuZGF0YS5yZWNvcmQ7CgpnZXRQYXJ0aWNpcGFudHNGb3JDdXJyZW50UmFmZmxlKCkudGhlbigocGFydGljaXBhbnRzKSA9PiB7CiAgICBpZiAocGFydGljaXBhbnRzLlBhcnRpY2lwYW50ID09PSB1bmRlZmluZWQgfHwgcGFydGljaXBhbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHN0cnlrZS5lcnJvcignVGhlcmUgYXJlIG5vIHBhcnRpY2lwYW50cyBvbiB0aGlzIHJhZmZsZSEnKTsKICAgIH0KICAgIGNvbnNvbGUubG9nKGBwYXJ0aWNpcGFudHMgY291bnQ6ICR7cGFydGljaXBhbnRzLlBhcnRpY2lwYW50Lmxlbmd0aH1gKTsKCiAgICAvLyBDaGVjayBpZiBhIHdpbm5lciBhbHJlYWR5IGV4aXN0cwogICAgZ2V0RXhpc3RpbmdXaW5uZXIoKS50aGVuKChleGlzdGluZ1dpbm5lcikgPT4gewogICAgICAgIGlmIChleGlzdGluZ1dpbm5lci5XaW5uZXIgIT09IHVuZGVmaW5lZCAmJiBleGlzdGluZ1dpbm5lci5XaW5uZXIubGVuZ3RoID4gMCkgewoKICAgICAgICAgICAgc3RyeWtlLmVycm9yKCdUaGVyZSBpcyBhIHdpbm5lciBhbHJlYWR5IScpOwogICAgICAgIH0KICAgIAogICAgICAgIC8vIEZpbmQgYSB3aW5uZXIKICAgICAgICBjb25zdCBuZXdXaW5uZXIgPSBwYXJ0aWNpcGFudHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcGFydGljaXBhbnRzLmxlbmd0aCldOwogICAgCiAgICAgICAgY29uc3QgcmFmZmxlV2lubmVyID0ge307CiAgICAgICAgcmFmZmxlV2lubmVyLm5hbWUgPSBuZXdXaW5uZXIubmFtZTsKICAgICAgICByYWZmbGVXaW5uZXIucGFydGljaXBhbnQgPSBuZXdXaW5uZXIuaWQ7CiAgICAKICAgICAgICAvLyBzYXZlIHRoZSBuZXcgd2lubmVyCiAgICAgICAgc3RyeWtlLmNyZWF0ZSgnd2lubmVyJywgcmFmZmxlV2lubmVyLCAoZXJyLCByZWNvcmRzU2F2ZWQpID0+IHsKICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgc3RyeWtlLmVycm9yKGVyci5tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zb2xlLmxvZygnc2F2ZWQ6ICcgKyByZWNvcmRzU2F2ZWQpOwogICAgICAgICAgICBzdHJ5a2UucmVzb2x2ZShgVGhlIHdpbm5lciBpczogJHtyYWZmbGVXaW5uZXIubmFtZX1gKTsKICAgICAgICB9KSAgCiAgICB9KTsKCn0pLmNhdGNoKChlcnIpID0+IHsKICAgIHN0cnlrZS5lcnJvcignc2NyaXB0IGZhaWxlZCB3aGlsZSByZXRyaWV2aW5nIHRoZSBwYXJ0aWNpcGFudHM6ICcgKyBlcnIpOwp9KTsKCi8qKgogKiBDaGVjayBpZiBhIHdpbm5lciBhbHJlYWR5IGV4aXN0cwogKi8KYXN5bmMgZnVuY3Rpb24gZ2V0RXhpc3RpbmdXaW5uZXIoKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBjb25zdCB3aW5uZXJzUXVlcnkgPSBgewogICAgICAgICAgICBXaW5uZXIoZmlsdGVyOiB7cmFmZmxlOiB7ZXE6ICIke3JhZmZsZS5pZH0ifX0pIHsKICAgICAgICAgICAgICAgIHBhcnRpY2lwYW50IHsKICAgICAgICAgICAgICAgICAgICBpZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgfQogICAgICAgIH1gOwogICAgICAgICAgICAgICAgCiAgICAgICAgc3RyeWtlLnF1ZXJ5KHdpbm5lcnNRdWVyeSwgdHJ1ZSwgKGVyciwgcmVzdWx0KSA9PiB7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBxdWVyeVJlc3VsdCA9IHByb2Nlc3NRdWVyeVJlc3VsdChlcnIsIHJlc3VsdCwgJ3dpbm5lcnNRdWVyeScpOyAgICAgICAgICAgIAogICAgICAgICAgICByZXNvbHZlKHF1ZXJ5UmVzdWx0KTsKICAgICAgICB9KTsKICAgIH0pOwp9CgovKioKICogR2V0IHBhcnRpY2lwYW50cwogKi8KYXN5bmMgZnVuY3Rpb24gZ2V0UGFydGljaXBhbnRzRm9yQ3VycmVudFJhZmZsZSgpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIGNvbnN0IHBhcnRpY2lwYW50c1F1ZXJ5ID0gYHsKICAgICAgICAgICAgUGFydGljaXBhbnQoZmlsdGVyOiB7cmFmZmxlOiB7ZXE6ICIke3JhZmZsZS5pZH0ifX0pIHsKICAgICAgICAgICAgICAgIG5hbWUKICAgICAgICAgICAgICAgIHVzZXIgewogICAgICAgICAgICAgICAgICAgIGlkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZAogICAgICAgICAgICB9CiAgICAgICAgfWA7CiAgICAgICAgICAgICAgICAKICAgICAgICBzdHJ5a2UucXVlcnkocGFydGljaXBhbnRzUXVlcnksIHRydWUsIChlcnIsIHJlc3VsdCkgPT4geyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcXVlcnlSZXN1bHQgPSBwcm9jZXNzUXVlcnlSZXN1bHQoZXJyLCByZXN1bHQsICdwYXJ0aWNpcGFudHMnKTsgICAgICAgICAgICAKICAgICAgICAgICAgcmVzb2x2ZShxdWVyeVJlc3VsdCk7CiAgICAgICAgfSk7CiAgICB9KTsKfQoKZnVuY3Rpb24gcHJvY2Vzc1F1ZXJ5UmVzdWx0KGVyciwgcmVzdWx0LCBxdWVyeU5hbWUpIHsKICAgIGlmIChlcnIpIHsKICAgICAgICBzdHJ5a2UuZXJyb3IoYHF1ZXJ5IHJlcXVlc3QgKCR7cXVlcnlOYW1lfSkgZmFpbGVkOiAke3V0aWwuaW5zcGVjdChlcnIpfWApOyAKICAgIH0KCiAgICBpZiAocmVzdWx0LmVycm9ycykgewogICAgICAgIHN0cnlrZS5lcnJvcihgcXVlcnkgKCR7cXVlcnlOYW1lfSkgZmFpbGVkOiAke3V0aWwuaW5zcGVjdChyZXN1bHQuZXJyb3JzKX1gKTsgICAgICAgICAKICAgIH0KCiAgICBpZiAoIXJlc3VsdC5kYXRhKSB7CiAgICAgICAgc3RyeWtlLmVycm9yKGBxdWVyeSByZXN1bHQgbWlzc2luZyBmb3IgJHtxdWVyeU5hbWV9YCk7ICAgICAgICAgCiAgICB9CgogICAgcmV0dXJuIHJlc3VsdC5kYXRhOwp9","scriptArguments":[{"argumentName":"user","argumentType":"object","argumentSourceType":"userInfo","argumentSourceDefinition":null},{"argumentName":"recordInContext","argumentType":"object","argumentSourceType":"recordInContext","argumentSourceDefinition":null}],"scriptResultDefinition":{"returnValueName":null,"returnType":"string"}},"notifyWinner":{"scriptName":"notifyWinner","scriptLanguage":"js","scriptSource":"Ci8qKgogKiBIZXJlIGlzIHlvdXIgbmV3IFN0cnlrZSBzY3JpcHQhCiAqCiAqIERvbid0IGZvcmdldCB0byBjaGVjayBvdXQgb3VyIGRvY3MgZm9yIGRldGFpbHMgYW5kIGFsd2F5cyBlbmQgeW91ciBzY3JpcHQgd2l0aCBzdHJ5a2UucmVzb2x2ZSgpCiAqLwpjb25zb2xlLmxvZygnSGVsbG8gc3RyeWtlIScpOwoKc3RyeWtlLnJlc29sdmUoJ05vdGlmaWVkIScpOwo=","scriptArguments":[{"argumentName":"user","argumentType":"object","argumentSourceType":"userInfo","argumentSourceDefinition":null},{"argumentName":"recordInContext","argumentType":"object","argumentSourceType":"recordInContext","argumentSourceDefinition":null}],"scriptResultDefinition":{"returnValueName":null,"returnType":"string"}},"enterRaffle":{"scriptName":"enterRaffle","scriptLanguage":"js","scriptSource":"Ci8qKgogKiBIZXJlIGlzIHlvdXIgbmV3IFN0cnlrZSBzY3JpcHQhCiAqCiAqIERvbid0IGZvcmdldCB0byBjaGVjayBvdXQgb3VyIGRvY3MgZm9yIGRldGFpbHMgYW5kIGFsd2F5cyBlbmQgeW91ciBzY3JpcHQgd2l0aCBzdHJ5a2UucmVzb2x2ZSgpCiAqLwpjb25zdCB1dGlsID0gcmVxdWlyZSgndXRpbCcpOwpjb25zdCByYWZmbGUgPSBzdHJ5a2UuZGF0YS5yZWNvcmQ7CgpwZXJmb3JtUmFmZmxlKCk7Cgphc3luYyBmdW5jdGlvbiBwZXJmb3JtUmFmZmxlKCkgewogICAgY29uc3QgcGFydGljaXBhbnQgPSBhd2FpdCBnZXRQYXJ0aWNpcGFudHNGb3JDdXJyZW50UmFmZmxlQW5kVXNlcigpOwogICAgaWYgKHBhcnRpY2lwYW50LlBhcnRpY2lwYW50ICE9PSB1bmRlZmluZWQgJiYgcGFydGljaXBhbnQuUGFydGljaXBhbnQubGVuZ3RoID4gMCkgewogICAgICAgIHN0cnlrZS5lcnJvcignWW91IGFyZSBhbHJlYWR5IHBhcnRpY2lwYXRpbmchJyk7CiAgICB9CiAgICAKICAgIGxldCBuZXdQYXJ0aWNpcGFudCA9IHt9OwogICAgbmV3UGFydGljaXBhbnQucmFmZmxlID0gcmFmZmxlLmlkOwogICAgbmV3UGFydGljaXBhbnQudXNlciA9IHN0cnlrZS51c2VyLmlkOwogICAgCiAgICAvLyBzYXZlIHRoZSBuZXcgcGFydGljaXBhbnQKICAgIHN0cnlrZS5jcmVhdGUoJ3BhcnRpY2lwYW50JywgbmV3UGFydGljaXBhbnQsIChlcnIsIHJlY29yZHNTYXZlZCkgPT4gewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgc3RyeWtlLmVycm9yKGVyci5tZXNzYWdlKTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coJ3NhdmVkOiAnICsgcmVjb3Jkc1NhdmVkKTsKICAgIH0pCiAgICAKICAgIHN0cnlrZS5yZXNvbHZlKCdZb3VyIGFyZSBub3cgcGFydGljaXBhdGluZyBvbiB0aGlzIHJhZmZsZS4gR29vZCBsdWNrIScpOwp9CgovKioKICogR2V0IHBhcnRpY2lwYW50cwogKi8KYXN5bmMgZnVuY3Rpb24gZ2V0UGFydGljaXBhbnRzRm9yQ3VycmVudFJhZmZsZUFuZFVzZXIoKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBjb25zdCBwYXJ0aWNpcGFudHNRdWVyeSA9IGB7CiAgICAgICAgICAgIFBhcnRpY2lwYW50KGZpbHRlcjogeyByYWZmbGU6IHtlcTogIiR7cmFmZmxlLmlkfSJ9LCB1c2VyOiB7ZXE6ICIke3N0cnlrZS51c2VyLmlkfSJ9fSkgewogICAgICAgICAgICAgICAgbmFtZQogICAgICAgICAgICAgICAgdXNlciB7CiAgICAgICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlkCiAgICAgICAgICAgIH0KICAgICAgICB9YDsKICAgICAgICAgICAgICAgIAogICAgICAgIHN0cnlrZS5xdWVyeShwYXJ0aWNpcGFudHNRdWVyeSwgdHJ1ZSwgKGVyciwgcmVzdWx0KSA9PiB7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBxdWVyeVJlc3VsdCA9IHByb2Nlc3NRdWVyeVJlc3VsdChlcnIsIHJlc3VsdCwgJ3BhcnRpY2lwYW50cycpOyAgICAgICAgICAgIAogICAgICAgICAgICByZXNvbHZlKHF1ZXJ5UmVzdWx0KTsKICAgICAgICB9KTsKICAgIH0pOwp9CgpmdW5jdGlvbiBwcm9jZXNzUXVlcnlSZXN1bHQoZXJyLCByZXN1bHQsIHF1ZXJ5TmFtZSkgewogICAgaWYgKGVycikgewogICAgICAgIHN0cnlrZS5lcnJvcihgcXVlcnkgcmVxdWVzdCAoJHtxdWVyeU5hbWV9KSBmYWlsZWQ6ICR7dXRpbC5pbnNwZWN0KGVycil9YCk7IAogICAgfQoKICAgIGlmIChyZXN1bHQuZXJyb3JzKSB7CiAgICAgICAgc3RyeWtlLmVycm9yKGBxdWVyeSAoJHtxdWVyeU5hbWV9KSBmYWlsZWQ6ICR7dXRpbC5pbnNwZWN0KHJlc3VsdC5lcnJvcnMpfWApOyAgICAgICAgIAogICAgfQoKICAgIGlmICghcmVzdWx0LmRhdGEpIHsKICAgICAgICBzdHJ5a2UuZXJyb3IoYHF1ZXJ5IHJlc3VsdCBtaXNzaW5nIGZvciAke3F1ZXJ5TmFtZX1gKTsgICAgICAgICAKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0LmRhdGE7Cn0K","scriptArguments":[{"argumentName":"user","argumentType":"object","argumentSourceType":"userInfo","argumentSourceDefinition":null},{"argumentName":"recordInContext","argumentType":"object","argumentSourceType":"recordInContext","argumentSourceDefinition":null}],"scriptResultDefinition":{"returnValueName":null,"returnType":"string"}}},"userRoles":{"admin":{"name":"admin"},"user":{"name":"user"}},"resourcesAccess":[]}